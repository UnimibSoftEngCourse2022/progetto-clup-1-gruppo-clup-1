{% extends 'base.html' %}
{% block title %}
Stores
{% endblock %}

{% block content%}
<h2>{{ store.name }}</h2>
<ul>
    <li>{{ store.address }}</li>
</ul>
<p>Waiting List Length: {{ waiting_queue_len }}</p>
<p>Active Pool Length: {{ active_pool_len }}</p>
<p>Current People Inside: {{ current_people_quantity }}</p>
<br>
<ul>
    {% for reservation_id in active_pool %}
    <li>
        Consume: {{ reservation_id }}
        <input id="consume_btn_{{ reservation_id }}" type="button" value="CONSUME!">
    </li>
    {% endfor %}
</ul>
<br>
<form , action="{{ url_for('stores.make_reservation_into_store', id=store.id) }}" method="post">
    <input name="csrf_token" type="hidden" value="{{ csrf_token() }}"/>
    <input type="submit" value="Make Reservation">
</form>
<input id="delete_reservation_wq" type="button" value="Delete Reservation From WQ">
<input id="free_btn" type="button" value="Free store space">
<script>
    function updateStore() {
        var new_name = $("#name").val();
        var new_address = $("#address").val();
        var new_capacity = $("#capacity").val();
        $.ajax({
            url: "{{ url_for('stores.show_store', id=store.id) }}",
            type: "PUT",
            data: {
                csrf_token: '{{ csrf_token() }}',
                name: new_name,
                address: new_address,
                capacity: new_capacity,
            },
            success: function (result) {
                location.reload();
            },
        });
    }
</script>
<div>
    <label for="name">Store name:</label><br>
    <input id="name" placeholder="ex. Esselunga" type="text"><br>
    <label for="address">Store address:</label><br>
    <input id="address" placeholder="ex. Barzano" type="text"><br>
    <label for="capacity">Store capacity:</label><br>
    <input id="capacity" placeholder="ex. 150" type="text"><br>
    <button onclick="updateStore()">Update Store!</button>
</div>
<script>
    $("#delete_reservation_wq").click(function () {
        $.ajax({
            url: "{{ url_for('stores.delete_reservation_from_waiting_queue', store_id=store.id) }}",
            type: 'DELETE',
            success: function (result) {
                $("#test").append("Delete Reservation From WQ Success.");
            }
        });
    });

    $("#free_btn").click(function () {
        $.ajax({
            url: "{{ url_for('stores.free_handler', store_id=store.id) }}",
            type: 'DELETE',
            data: {
                csrf_token: '{{ csrf_token() }}',
            },
            success: function (result) {
                location.reload();
            },
        });
    });

    {%
        for reservation_id in active_pool %}
    $("#consume_btn_{{ reservation_id }}").click(function () {
        $.ajax({
            url: "{{ url_for('stores.consume_handler', store_id=store.id, reservation_id=reservation_id) }}",
            type: 'DELETE',
            data: {
                csrf_token: '{{ csrf_token() }}',
            },
            success: function (result) {
                location.reload();
            },
        });
    });
    {%
        endfor %
    }
</script>
{% endblock %}
