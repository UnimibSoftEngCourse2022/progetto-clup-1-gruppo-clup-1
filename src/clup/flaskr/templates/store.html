{% extends 'base.html' %}
{% block title %}
Stores
{% endblock %}

{% block content%}
<h2>{{ store.name }}</h2>
<ul>
    <li>{{ store.address }}</li>
</ul>
<p>Waiting List Length: {{ waiting_queue_len }}</p>
<p>Active Pool Length: {{ active_pool_len }}</p>
<p>Current People Inside: {{ current_people_quantity }}</p>
<br>
<ul>
{% for reservation_id in active_pool %}
    <li>
        Consume: {{ reservation_id }}
        <input type="button" id="consume_btn_{{ reservation_id }}" value="CONSUME!">
    </li>
{% endfor %}
</ul>
<br>
<form action= "{{ url_for('stores.make_reservation_into_store', id=store.id) }}", method = "post">
    <input type="submit" value="Make Reservation">
</form>
<form action= "{{ url_for('stores.enable_reservation_into_store', id=store.id) }}", method = "post">
    <input type="submit" value="Enable Reservation">
</form>

<input type="button" id= "delete_reservation_wq" value="Delete Reservation From WQ">
<input type="button" id= "free_btn" value="Free store space">
<p id= "test"></p>
<script>
$("#delete_reservation_wq").click(function () {
    $.ajax({
        url: "{{ url_for('stores.delete_reservation_from_waiting_queue', store_id=store.id) }}",
        type: 'DELETE',
        success: function(result) {
            $( "#test" ).append( "Delete Reservation From WQ Success." );
        }
    });
});

$("#free_btn").click(function () {
    $.ajax({
        url: "{{ url_for('stores.free_handler', store_id=store.id) }}",
        type: 'DELETE',
        success: function(result) {
            location.reload();
        },
    });
});

{% for reservation_id in active_pool %}
$("#consume_btn_{{ reservation_id }}").click(function () {
    $.ajax({
        url: "{{ url_for('stores.consume_handler', store_id=store.id, reservation_id=reservation_id) }}",
        type: 'DELETE',
        success: function (result) {
            location.reload();
        },
    });
});
{% endfor %}
</script>
{% endblock %}
